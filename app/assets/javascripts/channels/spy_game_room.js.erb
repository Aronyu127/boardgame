$(document).on('turbolinks:load', function() {
  submitNewMessage();
});

<% GameRoom.where(game: 1).each do |spy_game_room| %>  
  App['room' + <%=spy_game_room.id%>] = App.cable.subscriptions.create({channel: 'SpyGameRoomChannel', room: <%=spy_game_room.id%>}, {  
  received: function(data) {
   $("[data-gameRoomId='" + this.gameRoomId + "']").removeClass('hidden')
    return $("[data-gameRoomId='" + this.gameRoomId + "']").append(data.message);
  },

  setGameroomId: function(gameRoomId) {
    this.gameRoomId = gameRoomId
  }
});
<% end %>

function submitNewMessage(){  
  $('textarea#message_content').keydown(function(event) {
    if (event.keyCode == 13) {
        var msg = event.target.value
        var gameRoomId = $("[data-gameRoomId]").data().gameroomid
        App['room' + gameRoomId].setGameroomId(gameRoomId)
        App['room' + gameRoomId].send({message: msg})
        $('[data-textarea="message"]').val(" ")
        return false;
     }
  });
}





// MakeSpyGameRoomChannel = function(roomId) {
//   App.spy_game_room = App.cable.subscriptions.create({
//     channel: "SpyGameRoomChannel",
//     roomId: roomId
//   }, {
//     connected: function() {
//       // Called when the subscription is ready for use on the server
//     },

//     disconnected: function() {
//       // Called when the subscription has been terminated by the server
//     },

//     // received: function(data) {
//     //   alert(data['message']);
//     // },

//     received: function(data) {
//       $("#messages").removeClass('hidden')
//       return $("[data-gameroom='" + data.game_room_id + "']").append(data.message);
//     },

//     speak: function(message, roomId) {
//       return this.perform('speak', {
//         message: message,
//         roomId: roomId
//       });
//     }
//   });
// };

// $(document).on('turbolinks:load', function() {
//   submitNewMessage();
// });

// function submitNewMessage(){  
//   $('textarea#message_content').keydown(function(event) {
//     if (event.keyCode === 13) {
//       var msg = event.target.value
//       var gameRoomId = $("[data-gameroom]").data().game_room
//       App.messages.send({message: msg, game_room_id: gameRoomId})
//       $('[data-textarea="message"]').val(" ")
//       return false;
//      }
//   });
// }
